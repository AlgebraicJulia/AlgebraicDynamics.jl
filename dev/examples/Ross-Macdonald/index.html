<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Ross-Macdonald Malaria Modeling · AlgebraicDynamics.jl</title><meta name="title" content="Ross-Macdonald Malaria Modeling · AlgebraicDynamics.jl"/><meta property="og:title" content="Ross-Macdonald Malaria Modeling · AlgebraicDynamics.jl"/><meta property="twitter:title" content="Ross-Macdonald Malaria Modeling · AlgebraicDynamics.jl"/><meta name="description" content="Documentation for AlgebraicDynamics.jl."/><meta property="og:description" content="Documentation for AlgebraicDynamics.jl."/><meta property="twitter:description" content="Documentation for AlgebraicDynamics.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><script src="../../assets/analytics.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AlgebraicDynamics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">AlgebraicDynamics.jl</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../Lotka-Volterra/">Lotka-Volterra Three Ways</a></li><li><a class="tocitem" href="../Ecosystem/">Ecosystem Models</a></li><li><a class="tocitem" href="../CPG_examples/">Open Circular Port Graph Examples</a></li><li><a class="tocitem" href="../Cyber-Physical/">Cyber Physical Systems Example</a></li><li class="is-active"><a class="tocitem" href>Ross-Macdonald Malaria Modeling</a><ul class="internal"><li><a class="tocitem" href="#Diagram-of-Systems"><span>Diagram of Systems</span></a></li><li><a class="tocitem" href="#ODE-Model"><span>ODE Model</span></a></li><li><a class="tocitem" href="#ODE-Model-using-instantaneous-machines"><span>ODE Model using instantaneous machines</span></a></li><li><a class="tocitem" href="#Delay-Model"><span>Delay Model</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../TLN/">Threshold Linear Networks</a></li><li><a class="tocitem" href="../../AlgebraicPetri/">AlgebraicPetri Integration</a></li><li><a class="tocitem" href="../../api/">Library Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Ross-Macdonald Malaria Modeling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Ross-Macdonald Malaria Modeling</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicDynamics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicDynamics.jl/blob/main/examples/Ross-Macdonald.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ross-macdonald"><a class="docs-heading-anchor" href="#ross-macdonald">Ross-Macdonald Malaria Modeling</a><a id="ross-macdonald-1"></a><a class="docs-heading-anchor-permalink" href="#ross-macdonald" title="Permalink"></a></h1><p><a href="https://nbviewer.jupyter.org/github/AlgebraicJulia/AlgebraicDynamics.jl/blob/gh-pages/dev/examples/Ross-Macdonald.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>Authors: Sean L. Wu and Sophie Libkind</p><pre><code class="language-julia hljs">using AlgebraicDynamics
using Catlab.WiringDiagrams, Catlab.Graphics

using ComponentArrays
using DelayDiffEq, DifferentialEquations
using Plots</code></pre><p>The Ross-Macdonald (RM) model is the canonical model of malaria transmission, first expressed by Sir Ronald Ross in 1911. The simplest form of the model is given by a system of 2 nonlinear ordinary differential equations describing <span>$Z$</span>, parasite prevalence in the mosquito vector population, and <span>$X$</span>, parasite prevalence in the vertebrate host population: $ \dot X = mazbZ(1 - X) - rX, \quad \dot Z = acX (e^{-gn} - Z) - gZ  \quad (1)$</p><p>The RM model is of supreme importance to modeling of malaria and other mosquito transmitted diseases because it is the simplest model that retains the fundamental processes involved in transmission: recovery of infected hosts, death of infected mosquitoes, and parasite transmission between discordant pairs of vectors and hosts. In this sense it represents the irreducible complexity to modeling mosquito borne diseases, such that any simpler model would be insufficient.</p><p>The model assumes that mosquitoes take bloodmeals (bites) on vertebrate hosts with rate <span>$a$</span>. Therefore, the per-capita rate at which susceptible mosquitoes become infected is <span>$acX$</span>, where <span>$c$</span> is the transmission efficiency from infectious humans to susceptible mosquitoes (probability of parasites successfully invading the mosquito given a bite occurs) and <span>$X$</span> is the probability the  bite lands on an infectious human. <span>$1-Z$</span> is the proportion of mosquitoes who are susceptible but given an incubation period of <span>$n$</span> days during which mosquitoes suffer per-capita mortality at rate <span>$g$</span>, only a proportion <span>$e^{-gn}$</span> survive incubation to become infectious. Therefore the classic RM model will have statics that are consistent with the incorporation of an incubation period of fixed duration, but dynamics will not, as the delay is not incorporated into the equations.</p><p>Susceptible humans acquire infection at a rate <span>$mabZ$</span>, where <span>$m = M/H$</span>, the ratio of mosquitoes to humans, <span>$a$</span> is as before, and <span>$b$</span> is the transmission efficiency from infectious mosquitoes to susceptible humans. Therefore <span>$mabZ$</span> gives the per-capita rate at which susceptible humans recieve parasites from the mosquito population. Infectious humans recover at a rate <span>$r$</span> (the rate at which the immune system clears parasites). Because <span>$m$</span> is considered a constant parameter, the model ignores seasonal fluctuations in mosquito (or host) population sizes. However, because the timescale of host dynamcis is typically slow in relation to mosquito dynamics, the approximation is often suitable over a transmission season.</p><p>The model&#39;s threshold criterion between the trivial equilibrium where both <span>$Z,X$</span> are equal to zero (no disease) and the endemic equilibrium can be expressed by the basic reproductive number, giving the expected number of secondary infections arising from the introduction of a single infectious human, <span>$R_0 = \frac{ma^2bce^{-gn}}{rg}.$</span> The endemic equilibrium is therefore: <span>$\bar{X}= \frac{R_{0}-1}{R_{0} + \frac{ac}{g}}, \quad \bar{Z} = \frac{ac\bar{X}}{g + ac\bar{X}} e^{-gn}.$</span></p><p>From these equations, the nonlinear relationships that characterize observed malaria transmission can be understood. We implement them as follows:</p><h2 id="Diagram-of-Systems"><a class="docs-heading-anchor" href="#Diagram-of-Systems">Diagram of Systems</a><a id="Diagram-of-Systems-1"></a><a class="docs-heading-anchor-permalink" href="#Diagram-of-Systems" title="Permalink"></a></h2><p>First we must construct a diagram of systems which describes the interaction between the mosquito and host populations. The arrows between the two subsystems represents the bidirectional infection during bloodmeals.</p><pre><code class="language-julia hljs">rm = WiringDiagram([], [:mosquitos, :humans])
mosq_box   = add_box!(rm, Box(:mosquitos, [:x], [:z]))
human_box  = add_box!(rm, Box(:humans, [:z], [:x]))
output_box = output_id(rm)

add_wires!(rm, Pair[
    (mosq_box, 1)  =&gt; (human_box, 1),
    (human_box, 1) =&gt; (mosq_box, 1),
    (mosq_box, 1)  =&gt; (output_box, 1),
    (human_box, 1) =&gt; (output_box, 2)]
)


to_graphviz(rm)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="126pt" height="143pt"
 viewBox="0.00 0.00 125.53 143.38" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 139.38)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-139.38 121.53,-139.38 121.53,4 -4,4"/>
<!-- n0out1 -->
<!-- n0out2 -->
<!-- n0out1&%2345;&gt;n0out2 -->
<!-- n1 -->
<!-- mosquitos -->
<g id="n1" class="node">
<title>n1</title>
<polygon fill="none" stroke="black" points="23,-97.5 23,-122.5 107,-122.5 107,-97.5 23,-97.5"/>
<text text-anchor="start" x="28" y="-106.3" font-family="Serif" font-size="14.00">mosquitos</text>
</g>
<!-- n1&%2345;&gt;n0out1 -->
<!-- z -->
<g id="e3" class="edge">
<title>n1:s&%2345;&gt;n0out1:n</title>
<path fill="none" stroke="black" d="M65,-98C65,-73.08 34.34,-83.65 22,-62 9.3,-39.72 11.6,-29.82 11.96,-6.25"/>
<polygon fill="black" stroke="black" points="13.71,-6.01 12,-1 10.21,-5.99 13.71,-6.01"/>
</g>
<!-- n2 -->
<!-- humans -->
<g id="n2" class="node">
<title>n2</title>
<polygon fill="none" stroke="black" points="31,-36.5 31,-61.5 98,-61.5 98,-36.5 31,-36.5"/>
<text text-anchor="start" x="36" y="-45.3" font-family="Serif" font-size="14.00">humans</text>
</g>
<!-- n1&%2345;&gt;n2 -->
<!-- z -->
<g id="e1" class="edge">
<title>n1:s&%2345;&gt;n2:n</title>
<path fill="none" stroke="black" d="M65,-98C65,-83.88 65,-79.1 65,-67.17"/>
<polygon fill="black" stroke="black" points="66.75,-67 65,-62 63.25,-67 66.75,-67"/>
</g>
<!-- n2&%2345;&gt;n0out2 -->
<!-- x -->
<g id="e4" class="edge">
<title>n2:s&%2345;&gt;n0out2:n</title>
<path fill="none" stroke="black" d="M65,-37C65,-22.68 60.32,-18.23 59.23,-6.22"/>
<polygon fill="black" stroke="black" points="60.97,-5.92 59,-1 57.47,-6.07 60.97,-5.92"/>
</g>
<!-- n2&%2345;&gt;n1 -->
<!-- x -->
<g id="e2" class="edge">
<title>n2:s&%2345;&gt;n1:n</title>
<path fill="none" stroke="black" d="M65,-35.5C65,-21.05 86.68,-26.93 97.5,-36.5 121.49,-57.72 122.09,-107.05 107,-122.5 95.28,-134.5 70.72,-140.82 65.85,-128.43"/>
<polygon fill="black" stroke="black" points="67.57,-128.13 65,-123.5 64.12,-128.72 67.57,-128.13"/>
</g>
</g>
</svg>
'/><h2 id="ODE-Model"><a class="docs-heading-anchor" href="#ODE-Model">ODE Model</a><a id="ODE-Model-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Model" title="Permalink"></a></h2><p>Next we implement the concrete mosquito and host dynamics given in Equation (1), and apply them to the diagram of systems. This composition is the complete Ross-Macdonald model which we can solve and plot.</p><pre><code class="language-julia hljs">dZdt = function(u,x,p,t)
    Z = u[1]
    X = x[1]
    [p.a*p.c*X*(exp(-p.g*p.n) - Z) - p.g*Z]
end

dXdt = function(u,x,p,t)
    X = u[1]
    Z = x[1]
    [p.m*p.a*p.b*Z*(1 - X) - p.r*X]
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">#3 (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">mosquito_model = ContinuousMachine{Float64}(1, 1, 1, dZdt, (u,p,t) -&gt; u)
human_model    = ContinuousMachine{Float64}(1, 1, 1, dXdt, (u,p,t) -&gt;  u)

malaria_model = oapply(rm,
    Dict(:humans =&gt; human_model, :mosquitos =&gt; mosquito_model)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ContinuousMachine(ℝ^2 × ℝ^0 → ℝ^2)</code></pre><pre><code class="language-julia hljs">params = ComponentArray(a = 0.3, b = 0.55, c = 0.15,
    g = 0.1, n = 10, r = 1.0/200, m = 0.5)


u0 = [0.1, 0.3]
tspan = (0.0, 365.0*2)

prob = ODEProblem(malaria_model, u0, tspan, params)
sol = solve(prob, Tsit5());</code></pre><pre><code class="language-julia hljs">plot(sol, malaria_model,
    lw=2, title = &quot;Ross-Macdonald Malaria model&quot;,
    xlabel = &quot;time&quot;, ylabel = &quot;proportion infectious&quot;,
    color = [&quot;magenta&quot; &quot;blue&quot;]
)

# Plot the equilibrium behavior as well
a, b, c, g, n, r, m = params
R0 = (m*a^2*b*c*exp(-g*n))/(r*g)
X̄ = (R0 - 1)/(R0 + (a*c)/g)
Z̄ = (a*c*X̄)/(g + a*c*X̄)*exp(-g*n)

N = length(sol)
plot!(sol.t, fill(X̄, N), label = &quot;human equilibrium&quot;, ls = :dash, lw = 2, color = &quot;blue&quot;)
plot!(sol.t, fill(Z̄, N), label = &quot;mosquito equilibrium&quot;, ls = :dash, lw = 2, color = &quot;magenta&quot;)</code></pre><img src="d821d59e.svg" alt="Example block output"/><h2 id="ODE-Model-using-instantaneous-machines"><a class="docs-heading-anchor" href="#ODE-Model-using-instantaneous-machines">ODE Model using instantaneous machines</a><a id="ODE-Model-using-instantaneous-machines-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Model-using-instantaneous-machines" title="Permalink"></a></h2><p>One way to decouple systems or isolate coupling points between different parts of a dynamical system is to use instantaneous machines, which allow processing of information to occur without (optionally) storing state themselves.</p><p>In this case we seperate the bloodmeal, where pathogen transmission occurs between the two species, into a seperate machine. This way, the dynamics of the human and mosquito machines do not need the other&#39;s state value, all the information has already been computed in the bloodmeal machine. For such a simple system, this arrangement may be superfluous, but in complex systems it can be beneficial to have seperate components which compute terms which are dependent on state variables &quot;external&quot; to a particular machine.</p><pre><code class="language-julia hljs">rmb = WiringDiagram([], [:mosquitos, :humans, :bloodmeal])
mosquito_box = add_box!(rmb, Box(:mosquitos, [:κ], [:Z]))
human_box = add_box!(rmb, Box(:humans, [:EIR], [:X]))
bloodmeal_box = add_box!(rmb, Box(:bloodmeal, [:X, :Z], [:κ, :EIR]))
output_box = output_id(rmb)

add_wires!(rmb, Pair[
    (bloodmeal_box, 1)  =&gt; (mosquito_box, 1),
    (bloodmeal_box, 2) =&gt; (human_box, 1),
    (human_box, 1)  =&gt; (bloodmeal_box, 1),
    (mosquito_box, 1) =&gt; (bloodmeal_box, 2),
    (mosquito_box, 1)  =&gt; (output_box, 1),
    (human_box, 1) =&gt; (output_box, 2)]
)</code></pre><p>The wiring diagram is below. The bloodmeal machine computes the EIR (entomological inoculation rate) which is proportional to the force of infection upon susceptible humans, and the net infectiousness of humans to mosquitoes, commonly denoted <span>$\kappa$</span>. The EIR is <span>$maZ$</span> where <span>$Z$</span> is the mosquito state variable, and <span>$\kappa$</span> is <span>$cX$</span> where <span>$X$</span> is the human state variable.</p><p>These two terms are sent from the bloodmeal machine to the mosquito and human machines via their input ports. Then the dynamical system filling the mosquito machine is <span>$\dot{Z} = a\kappa (e^{-gn} - Z) - gZ$</span> and <span>$\dot{X} = bEIR(1-X) - rX$</span> is the dynamical system filling the human machine.</p><pre><code class="language-julia hljs">to_graphviz(rmb)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="122pt" height="204pt"
 viewBox="0.00 0.00 122.00 204.38" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 200.38)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-200.38 118,-200.38 118,4 -4,4"/>
<!-- n0out1 -->
<!-- n0out2 -->
<!-- n0out1&%2345;&gt;n0out2 -->
<!-- n0out3 -->
<!-- n0out2&%2345;&gt;n0out3 -->
<!-- n1 -->
<!-- mosquitos -->
<g id="n1" class="node">
<title>n1</title>
<polygon fill="none" stroke="black" points="9,-158.5 9,-183.5 93,-183.5 93,-158.5 9,-158.5"/>
<text text-anchor="start" x="14" y="-167.3" font-family="Serif" font-size="14.00">mosquitos</text>
</g>
<!-- n1&%2345;&gt;n0out1 -->
<!-- Z -->
<g id="e5" class="edge">
<title>n1:s&%2345;&gt;n0out1:n</title>
<path fill="none" stroke="black" d="M51,-159C51,-138.17 28.81,-142.31 21,-123 1.3,-74.27 11.28,-56.55 11.96,-6.3"/>
<polygon fill="black" stroke="black" points="13.72,-6.01 12,-1 10.22,-5.99 13.72,-6.01"/>
</g>
<!-- n3 -->
<!-- bloodmeal -->
<g id="n3" class="node">
<title>n3</title>
<polygon fill="none" stroke="black" points="30,-97.5 30,-122.5 114,-122.5 114,-97.5 30,-97.5"/>
<text text-anchor="start" x="35" y="-106.3" font-family="Serif" font-size="14.00">bloodmeal</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<!-- Z -->
<g id="e4" class="edge">
<title>n1:s&%2345;&gt;n3:n</title>
<path fill="none" stroke="black" d="M51,-159C51,-136.34 86.69,-145.76 92.27,-128.11"/>
<polygon fill="black" stroke="black" points="94.03,-128.2 93,-123 90.56,-127.7 94.03,-128.2"/>
</g>
<!-- n2 -->
<!-- humans -->
<g id="n2" class="node">
<title>n2</title>
<polygon fill="none" stroke="black" points="31,-36.5 31,-61.5 98,-61.5 98,-36.5 31,-36.5"/>
<text text-anchor="start" x="36" y="-45.3" font-family="Serif" font-size="14.00">humans</text>
</g>
<!-- n2&%2345;&gt;n0out2 -->
<!-- X -->
<g id="e6" class="edge">
<title>n2:s&%2345;&gt;n0out2:n</title>
<path fill="none" stroke="black" d="M65,-37C65,-22.68 60.32,-18.23 59.23,-6.22"/>
<polygon fill="black" stroke="black" points="60.97,-5.92 59,-1 57.47,-6.07 60.97,-5.92"/>
</g>
<!-- n2&%2345;&gt;n3 -->
<!-- X -->
<g id="e3" class="edge">
<title>n2:s&%2345;&gt;n3:n</title>
<path fill="none" stroke="black" d="M65,-35.5C65,-20 118.93,-26.28 97.5,-62 80.01,-91.15 47.49,-68.85 30,-98 24.4,-107.34 22.49,-114.62 30,-122.5 34.84,-127.57 44.23,-130.85 48.63,-128.24"/>
<polygon fill="black" stroke="black" points="50.32,-128.75 51,-123.5 47.19,-127.19 50.32,-128.75"/>
</g>
<!-- n3&%2345;&gt;n1 -->
<!-- κ -->
<g id="e1" class="edge">
<title>n3:s&%2345;&gt;n1:n</title>
<path fill="none" stroke="black" d="M51,-96.5C51,-79.55 6.15,-81.91 30,-123 45.71,-150.06 129.86,-145.75 93,-183.5 81.28,-195.5 56.72,-201.82 51.85,-189.43"/>
<polygon fill="black" stroke="black" points="53.57,-189.13 51,-184.5 50.12,-189.72 53.57,-189.13"/>
</g>
<!-- n3&%2345;&gt;n2 -->
<!-- EIR -->
<g id="e2" class="edge">
<title>n3:s&%2345;&gt;n2:n</title>
<path fill="none" stroke="black" d="M93,-98C93,-79.63 70,-81.64 65.69,-67.09"/>
<polygon fill="black" stroke="black" points="67.41,-66.72 65,-62 63.94,-67.19 67.41,-66.72"/>
</g>
</g>
</svg>
'/><pre><code class="language-julia hljs">bloodmeal = function(u,x,p,t)
    X = x[1]
    Z = x[2]
    [p.c*X, p.m*p.a*Z]
end

dZdt = function(u,x,p,t)
    Z = u[1]
    κ = x[1]
    [p.a*κ*(exp(-p.g*p.n) - Z) - p.g*Z]
end

dXdt = function(u,x,p,t)
    X = u[1]
    EIR = x[1]
    [p.b*EIR*(1 - X) - p.r*X]
end

bloodmeal_model = InstantaneousContinuousMachine{Float64}(2, 0, 2, (u,x,p,t)-&gt;u, bloodmeal, [1=&gt;1,2=&gt;2])
mosquito_model = ContinuousMachine{Float64}(1, 1, 1, dZdt, (u,p,t) -&gt; u)
human_model    = ContinuousMachine{Float64}(1, 1, 1, dXdt, (u,p,t) -&gt;  u)

instantaneous_mosquito_model = InstantaneousContinuousMachine{Float64}(mosquito_model)
instantaneous_human_model = InstantaneousContinuousMachine{Float64}(human_model)

malaria_model = oapply(rmb,
    Dict(:mosquitos =&gt; instantaneous_mosquito_model, :humans =&gt; instantaneous_human_model, :bloodmeal =&gt; bloodmeal_model)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ContinuousMachine(ℝ^2 × ℝ^0 → ℝ^2)</code></pre><p>We use the same parameter values as previously given to solve the composed system, and plot the analytic equilibrium. Results are the same as for the previous system.</p><pre><code class="language-julia hljs">prob = ODEProblem(malaria_model, u0, tspan, params)
sol = solve(prob, Tsit5());</code></pre><pre><code class="language-julia hljs">plot(sol, label = [&quot;mosquitos&quot; &quot;humans&quot;],
    lw=2, title = &quot;Ross-Macdonald Malaria model&quot;,
    xlabel = &quot;time&quot;, ylabel = &quot;proportion infectious&quot;,
    color = [&quot;magenta&quot; &quot;blue&quot;]
)
N = length(sol)
plot!(sol.t, fill(X̄, N), label = &quot;human equilibrium&quot;, ls = :dash, lw = 2, color = &quot;blue&quot;)
plot!(sol.t, fill(Z̄, N), label = &quot;mosquito equilibrium&quot;, ls = :dash, lw = 2, color = &quot;magenta&quot;)</code></pre><img src="f7e8b726.svg" alt="Example block output"/><h2 id="Delay-Model"><a class="docs-heading-anchor" href="#Delay-Model">Delay Model</a><a id="Delay-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Delay-Model" title="Permalink"></a></h2><p>The previous models did not capture the incubation period for the disease in the mosquito population. To do so we can replace the models with delay differential equations and apply them to the same diagram of systems representing the bloodmeal.</p><pre><code class="language-julia hljs">dzdt_delay = function(u,x,h,p,t)
    Y, Z = u
    Y_delay, Z_delay = h(p, t - p.n)
    X, X_delay = x[1]

    [p.a*p.c*X*(1 - Y - Z) -
        p.a*p.c*X_delay*(1 - Y_delay - Z_delay)*exp(-p.g*p.n) -
        p.g*Y,
    p.a*p.c*X_delay*(1 - Y_delay - Z_delay)*exp(-p.g*p.n) -
        p.g*Z]
end

dxdt_delay = function(u,x,h,p,t)
    X, = u
    Z, _ = x[1]
    [p.m*p.a*p.b*Z*(1 - X) - p.r*X]
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">#23 (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">mosquito_delay_model = DelayMachine{Float64, 2}(
    1, 2, 1, dzdt_delay, (u,h,p,t) -&gt; [[u[2], h(p,t - p.n)[2]]])

human_delay_model = DelayMachine{Float64, 2}(
    1, 1, 1, dxdt_delay, (u,h,p,t) -&gt; [[u[1], h(p, t - p.n)[1]]])

malaria_delay_model = oapply(rm,
    Dict(:humans =&gt; human_delay_model, :mosquitos =&gt; mosquito_delay_model)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DelayMachine(ℝ^3 × ℝ^0 → ℝ^3)</code></pre><pre><code class="language-julia hljs">params = ComponentArray(a = 0.3, b = 0.55, c = 0.15,
    g = 0.1, n = 10, r = 1.0/200, m = 0.5)

u0_delay = [0.09, .01, 0.3]
tspan = (0.0, 365.0*3)
hist(p,t) = u0_delay;

prob = DDEProblem(malaria_delay_model, u0_delay, [], hist, tspan, params)
alg = MethodOfSteps(Tsit5())
sol = solve(prob, alg)

plot(sol, label=[&quot;non-infectious mosquito population&quot; &quot;infectious mosquito population&quot; &quot;host population&quot;],
    lw=2, title = &quot;Ross-Macdonald malaria model&quot;,
    xlabel = &quot;time&quot;, ylabel = &quot;proportion infectious&quot;,
    color = [&quot;magenta&quot; &quot;red&quot; &quot;blue&quot;]
)
N = length(sol)
plot!(sol.t, fill(X̄, N), label = &quot;human equilibrium&quot;, ls = :dash, lw = 2, color = &quot;blue&quot;)
plot!(sol.t, fill(Z̄, N), label = &quot;infectious mosquito equilibrium&quot;, ls = :dash, lw = 2, color = &quot;red&quot;)</code></pre><img src="b58ed7d5.svg" alt="Example block output"/><p>While the equilibrium points of the two models are identical, they exhibit different dynamical behavior before settling down to equilibrium. Because models are often used to examine how the system may respond to intervention, incorporating additional biological realism can produce more plausible results regarding the expected time for interventions to affect the system. In any case, such simple models are best used as tools to explain basic concepts in malaria epidemiology rather than descriptions of real systems, which are likely far from equilibrium and affected by weather, climate, policy, and other external forces.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Cyber-Physical/">« Cyber Physical Systems Example</a><a class="docs-footer-nextpage" href="../../TLN/">Threshold Linear Networks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Wednesday 31 July 2024 01:49">Wednesday 31 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
